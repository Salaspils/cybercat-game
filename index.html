<!DOCTYPE html>
<html lang="ru">
<!-- 
    ================================================================================
    CYBERCAT PROJECT PASSPORT & DEPLOYMENT LOG (v90.0)
    ================================================================================
    !!! MANDATORY AI DIRECTIVE: PRESERVE THIS HEADER AND ALL DIALOGUE HISTORY !!!
    
    ОФИЦИАЛЬНЫЙ АДРЕС ПРОЕКТА (LIVE URL):
    - https://salaspils.github.io/cybercat-game/
    
    КОНФИГУРАЦИЯ СИСТЕМЫ (HARDWARE):
    - GPU: NVIDIA GeForce RTX 5070 Ti (Active Render)
    - CPU: x64 Architecture / ОС: Windows / Disk C: (167GB Free)
    
    АРХИВ РАЗРАБОТКИ & ПОСЛЕДНИЕ РЕШЕНИЯ (LOG):
    - [RECOVERY]: Восстановили three.min.js (546Кб) после сбоя терминала.
    - [FIX]: Исправили опечатку в названии (пробел заменен на точку: "three.min.js").
    - [STRATEGY]: Сохраняем ВСЮ историю диалогов и паспорт прямо в коде (хоть до Гб).
    - [LINK]: Решили вшить прямую ссылку на GitHub Pages в тело кода для памяти.
    
    ТЕКУЩИЙ СТАТУС: Развертывание завершено. Шейдеры RTX активны.
    ================================================================================
-->
<head>
    <meta charset="UTF-8">
    <title>CyberCat v90.0: Live on GitHub Pages</title>
    <script src="three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #010102; font-family: 'Segoe UI', sans-serif; }
        #ui { position: fixed; top: 20px; left: 20px; z-index: 100; pointer-events: none; }
        .hud { background: rgba(0,0,0,0.92); border-left: 5px solid #00ffcc; padding: 20px; color: #fff; backdrop-filter: blur(15px); border-radius: 2px; }
        .btns { position: fixed; bottom: 30px; width: 100%; display: flex; justify-content: center; gap: 15px; pointer-events: auto; }
        .btn { background: #000; color: #00ffcc; border: 1px solid #00ffcc; padding: 12px 25px; cursor: pointer; font-weight: 900; text-transform: uppercase; transition: 0.2s; outline: none; }
        .btn:hover { background: #00ffcc; color: #000; box-shadow: 0 0 30px #00ffcc; }
        #clock { font-size: 28px; color: #fff; font-weight: 900; }
    </style>
</head>
<body>
    <div id="ui"><div class="hud"><div id="clock">00:00</div><div style="font-size: 14px; color:#00ffcc;">$MEOW: <span id="bal">0</span></div></div></div>
    <div class="btns">
        <button class="btn" onclick="buildShed()">ПОСТРОИТЬ СРУБ (900)</button>
        <button class="btn" onclick="resetGame()" style="color:#ff4444; border-color:#ff4444;">WIPE</button>
    </div>

    <script>
        // ИНИЦИАЛИЗАЦИЯ v90.0
        let db = JSON.parse(localStorage.getItem('cyber_v75')) || { bal: 1000, builds: [], pos: {x: 0, z: 0}, time: 480 };
        const save = () => { localStorage.setItem('cyber_v75', JSON.stringify(db)); document.getElementById('bal').innerText = Math.floor(db.bal); };
        window.resetGame = () => { if(confirm("ВНИМАНИЕ: Сбросить мир и историю v90.0?")) { localStorage.clear(); location.reload(); } };

        let scene, camera, renderer, cat, targetPos, grassMat, velocity = new THREE.Vector3(0,0,0), zoom = 120, CLOCK = new THREE.Clock();

        function init() {
            scene = new THREE.Scene(); scene.background = new THREE.Color(0x010102); scene.fog = new THREE.FogExp2(0x010102, 0.002);
            camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 1, 10000);
            renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
            renderer.setSize(window.innerWidth, window.innerHeight); renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0x404040, 0.8));
            const sun = new THREE.DirectionalLight(0xffffff, 1.6); sun.position.set(200, 500, 100); sun.castShadow = true;
            sun.shadow.mapSize.width = 4096; sun.shadow.mapSize.height = 4096; 
            scene.add(sun);

            const ground = new THREE.Mesh(new THREE.PlaneGeometry(5000, 5000), new THREE.MeshStandardMaterial({ color: 0x050505 }));
            ground.rotation.x = -Math.PI/2; ground.receiveShadow = true; scene.add(ground);

            const grassGeo = new THREE.PlaneGeometry(0.5, 3, 1, 4); grassGeo.translate(0, 1.5, 0);
            grassMat = new THREE.MeshStandardMaterial({ color: 0x0a1f0a, side: 2 });
            grassMat.onBeforeCompile = (shader) => {
                shader.uniforms.uTime = { value: 0 };
                shader.vertexShader = `uniform float uTime;\n` + shader.vertexShader;
                shader.vertexShader = shader.vertexShader.replace(`#include <begin_vertex>`,
                    `float wave = sin(uTime + position.x * 0.3 + position.z * 0.3) * (uv.y * 0.6);
                     vec3 transformed = vec3(position.x + wave, position.y, position.z + wave);`);
                grassMat.userData.shader = shader;
            };

            const instGrass = new THREE.InstancedMesh(grassGeo, grassMat, 30000);
            const dummy = new THREE.Object3D();
            for(let i=0; i<30000; i++) {
                dummy.position.set((Math.random()-0.5)*2500, 0, (Math.random()-0.5)*2500);
                dummy.rotation.y = Math.random()*Math.PI; dummy.updateMatrix(); instGrass.setMatrixAt(i, dummy.matrix);
            }
            scene.add(instGrass);

            cat = new THREE.Group();
            const body = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 1, 3.2, 16), new THREE.MeshStandardMaterial({color:0x00ffcc, emissive: 0x002222}));
            body.rotation.z = Math.PI/2; body.position.y = 1.3; body.castShadow = true; cat.add(body);
            cat.position.set(db.pos.x, 0, db.pos.z); scene.add(cat);
            targetPos = new THREE.Vector3(db.pos.x, 0, db.pos.z);

            db.builds.forEach(p => renderShed(p));

            window.addEventListener('wheel', (e) => zoom = Math.max(50, Math.min(500, zoom + e.deltaY * 0.15)));
            window.addEventListener('pointerdown', (e) => {
                if(e.target.tagName === 'BUTTON') return;
                const m = new THREE.Vector2((e.clientX/window.innerWidth)*2-1, -(e.clientY/window.innerHeight)*2+1);
                const ray = new THREE.Raycaster(); ray.setFromCamera(m, camera);
                const hit = ray.intersectObject(ground);
                if(hit.length > 0) { targetPos.copy(hit.point); db.pos = {x: targetPos.x, z: targetPos.z}; save(); }
            });
            save(); animate();
        }

        function renderShed(p) {
            const s = new THREE.Group();
            const m = new THREE.MeshStandardMaterial({color: 0x3d2b1f});
            for(let i=0; i<10; i++) {
                const log = new THREE.Mesh(new THREE.BoxGeometry(12, 1.4, 1.4), m);
                log.position.y = i * 1.3; log.rotation.y = (i % 2 === 0) ? 0 : Math.PI/2;
                log.castShadow = true; s.add(log);
            }
            s.position.set(p.x, 0, p.z); scene.add(s);
        }

        window.buildShed = () => { if(db.bal >= 900) { db.bal -= 900; const p = {x: cat.position.x, z: cat.position.z}; db.builds.push(p); renderShed(p); save(); } };

        function animate() {
            requestAnimationFrame(animate);
            const dt = Math.min(CLOCK.getDelta(), 0.1);
            if(grassMat.userData.shader) grassMat.userData.shader.uniforms.uTime.value = Date.now() * 0.003;
            if (cat.position.distanceTo(targetPos) > 0.5) {
                velocity.add(new THREE.Vector3().subVectors(targetPos, cat.position).normalize().multiplyScalar(110 * dt));
            }
            velocity.multiplyScalar(0.85); cat.position.add(velocity.clone().multiplyScalar(dt));
            if(velocity.length() > 0.1) cat.lookAt(cat.position.x + velocity.x, 0, cat.position.z + velocity.z);
            camera.position.lerp(cat.position.clone().add(new THREE.Vector3(-zoom, zoom, zoom)), 0.07); 
            camera.lookAt(cat.position);
            db.time += dt * 15; 
            document.getElementById('clock').innerText = `${Math.floor((db.time/60)%24).toString().padStart(2,'0')}:${Math.floor(db.time%60).toString().padStart(2,'0')}`;
            renderer.render(scene, camera);
        }
        init();
    </script>
</body>
</html>
