html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CyberCat: Final Stable v49</title>
    <script src="https://cdn.jsdelivr.net"></script>
    <script src="https://telegram.org"></script>
    <style>
        body { margin: 0; background: #020502; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        #ui { position: fixed; top: 15px; width: 100%; display: flex; justify-content: space-around; z-index: 100; pointer-events: none; }
        .glass { background: rgba(0,0,0,0.85); border: 1px solid #4CAF50; padding: 10px 20px; border-radius: 15px; color: #fff; pointer-events: auto; box-shadow: 0 0 15px #4CAF5055; }
        #msg { position: fixed; bottom: 20px; width: 100%; text-align: center; color: #4CAF50; font-size: 12px; opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body>
    <div id="ui">
        <div class="glass">üí∞ <span id="bal">0</span> $MEOW</div>
        <div class="glass">‚ö° <span id="nrg">100</span>%</div>
    </div>
    <div id="msg">–£–ü–†–ê–í–õ–ï–ù–ò–ï: –ú–´–®–¨ / WASD / –¢–ê–ü</div>

    <script>
        const tg = window.Telegram?.WebApp;
        let db = JSON.parse(localStorage.getItem('cybercat_v49_save')) || { bal: 0, nrg: 100 };

        // --- ENGINE ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x020502);
        scene.fog = new THREE.FogExp2(0x020502, 0.015);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // --- LIGHTS ---
        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const sun = new THREE.DirectionalLight(0xffffff, 1.2);
        sun.position.set(20, 50, 20);
        sun.castShadow = true;
        scene.add(sun);

        // --- WORLD ---
        const ground = new THREE.Mesh(new THREE.PlaneGeometry(1000, 1000), new THREE.MeshStandardMaterial({color: 0x1a2e1a}));
        ground.rotation.x = -Math.PI/2; ground.receiveShadow = true; scene.add(ground);
        
        const pond = new THREE.Mesh(new THREE.CircleGeometry(12, 32), new THREE.MeshStandardMaterial({color: 0x0077ff, transparent: true, opacity: 0.6}));
        pond.rotation.x = -Math.PI/2; pond.position.set(-15, 0.1, -15); scene.add(pond);

        // --- FAUNA ---
        const fauna = [];
        const spawn = (type, x, z) => {
            const group = new THREE.Group();
            const color = type === 'duck' ? 0xffff00 : 0xffffff;
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.7, 0.5, 1), new THREE.MeshStandardMaterial({color}));
            body.castShadow = true; group.add(body);
            group.position.set(x, 0.3, z); scene.add(group);
            fauna.push({ mesh: group, target: new THREE.Vector3(x, 0.3, z), type });
        };
        for(let i=0; i<8; i++) spawn(i%2===0?'duck':'goose', Math.random()*40-20, Math.random()*40-20);

        // --- PLAYER ---
        const cat = new THREE.Mesh(new THREE.SphereGeometry(0.8, 32, 32), new THREE.MeshStandardMaterial({color: 0x111, emissive: 0x00ffcc, emissiveIntensity: 0.5}));
        cat.castShadow = true; cat.position.y = 0.8; scene.add(cat);
        let target = new THREE.Vector3(0, 0.8, 0);

        // --- CONTROLS ---
        const keys = {};
        window.addEventListener('keydown', (e) => keys[e.code] = true);
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        window.addEventListener('pointerdown', (e) => {
            const mouse = new THREE.Vector2((e.clientX/window.innerWidth)*2-1, -(e.clientY/window.innerHeight)*2+1);
            const ray = new THREE.Raycaster();
            ray.setFromCamera(mouse, camera);
            const hit = ray.intersectObject(ground);
            if(hit.length > 0) target.copy(hit.point).y = 0.8;
        });

        function save() {
            localStorage.setItem('cybercat_v49_save', JSON.stringify(db));
            document.getElementById('bal').innerText = Math.floor(db.bal);
            document.getElementById('nrg').innerText = Math.floor(db.nrg);
        }

        // --- LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            
            // Movement logic
            const s = 0.4;
            if(keys['KeyW'] || keys['ArrowUp']) target.z -= s;
            if(keys['KeyS'] || keys['ArrowDown']) target.z += s;
            if(keys['KeyA'] || keys['ArrowLeft']) target.x -= s;
            if(keys['KeyD'] || keys['ArrowRight']) target.x += s;
            cat.position.lerp(target, 0.1);

            // AI Logic
            fauna.forEach(a => {
                if(Math.random() > 0.99) a.target.set(Math.random()*60-30, 0.3, Math.random()*60-30);
                const distToPond = a.mesh.position.distanceTo(pond.position);
                a.mesh.position.lerp(a.target, 0.02);
                a.mesh.position.y = (distToPond < 12) ? 0.05 + Math.sin(Date.now()*0.002)*0.1 : 0.4;
                a.mesh.lookAt(a.target);
            });

            if(db.nrg < 100) db.nrg += 0.01;
            save();

            camera.position.lerp(new THREE.Vector3(cat.position.x, 25, cat.position.z + 30), 0.05);
            camera.lookAt(cat.position);
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
        tg?.ready();
    </script>
</body>
</html>
