// ... (начало кода из v71 оставляем, меняем только логику в init и animate)

        function init() {
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e); // Глубокий предрассветный
            scene.fog = new THREE.FogExp2(0x1a1a2e, 0.0015);

            const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 1, 6000);
            const renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            const sun = new THREE.DirectionalLight(0xfff5e6, 2.5);
            sun.position.set(400, 600, -200); sun.castShadow = true;
            scene.add(sun);
            scene.add(new THREE.HemisphereLight(0x87ceeb, 0x1a1a2e, 0.8));

            // ГРУНТ
            const ground = new THREE.Mesh(new THREE.PlaneGeometry(5000, 5000), new THREE.MeshStandardMaterial({ color: 0x12180a }));
            ground.rotation.x = -Math.PI/2; ground.receiveShadow = true; scene.add(ground);

            // ТРАВА С ШЕЙДЕРОМ ВЕТРА
            const grassGeo = new THREE.PlaneGeometry(0.6, 2.5);
            grassGeo.translate(0, 1.25, 0); // Смещаем центр для качания от корня
            const grassMat = new THREE.MeshStandardMaterial({ color: 0x2d3d1f, side: 2 });
            const instancedGrass = new THREE.InstancedMesh(grassGeo, grassMat, 15000);
            const dummy = new THREE.Object3D();
            for(let i=0; i<15000; i++) {
                dummy.position.set((Math.random()-0.5)*1000, 0, (Math.random()-0.5)*1000);
                dummy.rotation.y = Math.random()*Math.PI;
                dummy.scale.setScalar(0.5 + Math.random());
                dummy.updateMatrix();
                instancedGrass.setMatrixAt(i, dummy.matrix);
            }
            scene.add(instancedGrass);

            // КОТ
            const cat = new THREE.Group();
            const catMat = new THREE.MeshStandardMaterial({ color: 0x111111 });
            const body = new THREE.Mesh(new THREE.CylinderGeometry(1, 1.2, 3.5, 12), catMat);
            body.rotation.z = Math.PI/2; body.position.y = 1.5; body.castShadow = true; cat.add(body);
            const head = new THREE.Mesh(new THREE.SphereGeometry(1.1, 12, 12), catMat);
            head.position.set(2, 2.2, 0); cat.add(head);
            scene.add(cat);
            
            let targetPos = new THREE.Vector3(0,0,0);

            // Клик для перемещения
            window.addEventListener('pointerdown', (e) => {
                const m = new THREE.Vector2((e.clientX/window.innerWidth)*2-1, -(e.clientY/window.innerHeight)*2+1);
                const ray = new THREE.Raycaster(); ray.setFromCamera(m, camera);
                const hit = new THREE.Vector3();
                if(ray.ray.intersectPlane(new THREE.Plane(new THREE.Vector3(0,1,0), 0), hit)) targetPos.copy(hit);
            });

            function animate() {
                requestAnimationFrame(animate);
                const t = Date.now() * 0.002;

                // 1. АНИМАЦИЯ ВЕТРА (Трава)
                instancedGrass.rotation.x = Math.sin(t) * 0.05;
                instancedGrass.rotation.z = Math.cos(t * 0.5) * 0.03;

                // 2. ФИЗИКА КОТА
                cat.position.lerp(targetPos, 0.05);
                cat.lookAt(targetPos.x, 0, targetPos.z);

                // 3. CINEMATIC CAMERA (Плавное слежение)
                const idealOffset = new THREE.Vector3(-40, 40, 40);
                idealOffset.add(cat.position);
                camera.position.lerp(idealOffset, 0.05);
                camera.lookAt(cat.position);

                renderer.render(scene, camera);
            }
            animate();
        }
        init();
