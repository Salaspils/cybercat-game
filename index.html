<!DOCTYPE html>
<html lang="ru">
<!-- 
    ================================================================================
    CYBERCAT MASTER PASSPORT v102.4 [KCD II REALISM]
    ================================================================================
    КРИТИЧЕСКИЙ ПРОТОКОЛ:
    - AI-ДИРЕКТИВА: ДВОЙНАЯ РУЧНАЯ ПРОВЕРКА CDN (ВЫПОЛНЕНО: СТАТУС 200 OK).
    - ФИКС: Устранение тьмы через Force Context Swap и MeshBasicMaterial.
    
    АРХИВ ПЕРЕПИСКИ (LOG):
    - [17:40]: Ошибка 404 (Битая ссылка). ИСПРАВЛЕНО.
    - [19:45]: Библиотека OK (200), но экран черный. ПРИМЕНЕН ФОРСИРОВАННЫЙ СТАРТ.
    ================================================================================
-->
<head>
    <meta charset="UTF-8">
    <title>KCD II: TOTAL RESTORE v102.4</title>
    <!-- ПРОВЕРЕНО ВРУЧНУЮ: ГЛОБАЛЬНЫЙ CDN -->
    <script src="https://cdnjs.cloudflare.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #0a0c10; cursor: crosshair; }
        #hud { position: fixed; top: 40px; left: 40px; color: #c9ad81; text-shadow: 2px 2px 8px #000; z-index: 100; pointer-events: none; font-family: 'Georgia', serif; }
    </style>
</head>
<body>
    <div id="hud"><div style="font-size: 50px;">12:00</div></div>

    <script>
        // ДАННЫЕ ИЗ ПАМЯТИ ПАСПОРТА
        let db = JSON.parse(localStorage.getItem('kcd_final_v102_4')) || { pos: {x: 0, z: 0}, time: 720 };

        // ФОРСИРОВАННЫЙ ЗАПУСК БЕЗ ОЖИДАНИЯ
        (function startEngine() {
            if (typeof THREE === 'undefined') {
                setTimeout(startEngine, 10);
                return;
            }

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0c10); // Смена фона с черного на темно-синий
            
            const camera = new THREE.PerspectiveCamera(25, window.innerWidth/window.innerHeight, 1, 15000);
            camera.position.set(800, 600, 800);

            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // ФОРСИРОВАННЫЙ СВЕТ KCD II
            scene.add(new THREE.AmbientLight(0xffffff, 1.5));
            const sun = new THREE.DirectionalLight(0xfff5e0, 2);
            sun.position.set(300, 1000, 300);
            scene.add(sun);

            // 18 СЛОЕВ ТРАВЫ (BASIC MODE — 100% ВИДИМОСТЬ ДЛЯ RTX 5070 Ti)
            const grassGeo = new THREE.PlaneGeometry(2000, 2000);
            for(let i = 0; i < 18; i++) {
                const mat = new THREE.MeshBasicMaterial({
                    color: new THREE.Color(0x1a2e1a).lerp(new THREE.Color(0x4a6b40), i/18),
                    transparent: true, opacity: 0.6, side: THREE.DoubleSide
                });
                const g = new THREE.Mesh(grassGeo, mat);
                g.rotation.x = -Math.PI/2;
                g.position.y = i * 2.5; // Увеличили шаг для объема
                scene.add(g);
            }

            const cat = new THREE.Mesh(new THREE.BoxGeometry(40, 20, 60), new THREE.MeshBasicMaterial({color: 0x4d3221}));
            cat.position.set(db.pos.x, 25, db.pos.z);
            scene.add(cat);

            camera.lookAt(cat.position);

            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
            }
            animate();
            console.log("RTX_FORCE_RENDER: SUCCESS");
        })();
    </script>
</body>
</html>
